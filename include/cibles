#
#
#   Targets to load gemdm
#
gem: gemntr gemdm

gem4d:
	make gem V4D="gemdyn_v4d $(PROF)" PROFLIBPATH=$(ARMNLIB)/lib/$(BASE_ARCH)

gem_nompi: gemntr_nompi gemdm_nompi

gemntr_nompi:
	make gemntr COMM_stubs=rpn_commstubs$(COMM_VERSION) MPI=

gemdm_nompi:
	make gemdm COMM_stubs=rpn_commstubs$(COMM_VERSION) MPI=

gemntr:
	makemodelbidon gemntr > bidon.f90 ; $(MAKE) bidon.o ; rm -f bidon.f90 ;\
	cd $(LCLPO); /bin/rm -f $(mainntr)* ;\
	$(RBUILD) -obj *.o -libpath $(LIBPATH) -optf "=$(LFLAGS)" -o $(mainntr) $(OMP) -libappl "$(LIBS)" -librmn $(RMN_VERSION) -codebeta $(CODEBETA) $(MPI);\
	/bin/cp $(mainntr) $(PWD)/$(mainntr) ; /bin/rm -f $(mainntr)* bidon.o;\
	chmod u+x $(PWD)/$(mainntr) ;\
	echo DYN_VERSION   = $(ATM_DYN_VERSION);\
	echo PHY_VERSION   = $(ATM_PHY_VERSION);\
	echo CHM_VERSION   = $(CHM_VERSION);\
	echo CPL_VERSION   = $(CPL_VERSION);\
	echo VGRID_VERSION = $(VGRID_VERSION);\
	echo RMN_VERSION   = $(RMN_VERSION);\
	echo COMM_VERSION  = $(COMM_VERSION)

gemdm:
	makemodelbidon gemdm > bidon.f90 ; $(MAKE) bidon.o ; rm -f bidon.f90 ;\
	cd $(LCLPO) ; /bin/rm -f $(maindm)* ;\
	$(RBUILD) -obj *.o -libpath $(LIBPATH) -optf "=$(LFLAGS)" -o $(maindm) $(OMP) -libappl "$(LIBS)" -librmn $(RMN_VERSION) -codebeta $(CODEBETA) $(MPI) ;\
	/bin/cp $(maindm) $(PWD)/$(maindm) ; /bin/rm -f $(maindm)* bidon.o;\
	chmod u+x $(PWD)/$(maindm) ;\
	echo DYN_VERSION   = $(ATM_DYN_VERSION);\
	echo PHY_VERSION   = $(ATM_PHY_VERSION);\
	echo CHM_VERSION   = $(CHM_VERSION);\
	echo CPL_VERSION   = $(CPL_VERSION);\
	echo VGRID_VERSION = $(VGRID_VERSION);\
	echo RMN_VERSION   = $(RMN_VERSION);\
	echo COMM_VERSION  = $(COMM_VERSION)

include $(gemdyn)/include/cibles_sometools

