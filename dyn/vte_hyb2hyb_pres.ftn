! ------------------------------------------------------------------------------------------------------------------------------
! EC-RPN COMM Group License/Disclaimer, version 2, Last Modified: Jan 08th, 2008 , Environment Canada
! 
! This is free software, you can use/redistribute/modify it under the terms of the EC-RPN COMM Group License/Disclaimer version 2 
! or (at your option) any later version that should be found at http://collaboration.cmc.ec.gc.ca/science/rpn.comm/license.html 
! 
! This software is distributed in the hope that it will be useful, but WITHOUT ANY WARRANTY; without even the implied warranty of
! MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the EC-RPN COMM Group License/Disclaimer for more details.
! 
! You should have received a copy of the EC-RPN COMM Group License/Disclaimer along with this software; if not, write to the
! EC-RPN COMM Group, 2121 TransCanada, suite 500, Dorval (Quebec), CANADA, H9P 1J3 ; or send e-mail to service.rpn@ec.gc.ca
! ------------------------------------------------------------------------------------------------------------------------------
***s/r vte_hyb2hyb_pres  cubic vertical interpolation from hybrid to hybrid
*
      subroutine vte_hyb2hyb_pres ( F_dch, F_dpres,
     $       nkd, F_sch, F_spia,F_spib, F_sp0, nks, n, F_var, F_sig_L)
#include "impnone.cdk"
*
       integer n, nkd, nks
       real F_dch(n,nkd), F_dpres(n,nkd),
     $      F_sch(n,nks), F_spia(nks), F_spib(nks), F_sp0(n)
       character*2 F_var
       logical F_sig_L
*
*author - L. Corbeil     - Aug 2001 - v2_30 (vte_intvertx)
*
*revision
* v2_31 - Lee V.              - calculates the source and destination levels
* v2_31                         before calling vte_intvertx
* v3_00 - Desgagne & Lee    - Lam configuration
*
*object
*       see above id
*
*arguments
*  Name        I/O                 Description
*----------------------------------------------------------------
* F_sch        I          source field                 
* F_dch        O          Interpolated field           
* F_spia       I          source pia, source sigma if F_sig_L true
* F_spib       I          source pib
* F_dpres      I          destination pressure
* F_sp0        I          source surface pressure
* F_var        I          name of the variable
* F_sig_L      I          TRUE if sigma levels
*                                                           
*----------------------------------------------------------------------
*
*implicites
#include "model_macros_f.h"
#include "dcst.cdk"
*
**
*
      integer i,k,iter,niter,lev,lev_lin
      integer top(n),bot(n),topcub(n),botcub(n),ref(n)
      real srclev(n,nks),dstlev(n,nkd)
      real*8 deltalev,prxd,prda,prdb,prsaf,prsbf,prsad,prsbd
*
*     ---------------------------------------------------------------
*
*
*     Filling level grid (source and destination)
*
      if (F_sig_L) then
          do k=1,nks
          do i=1,n
             srclev(i,k)= log(F_spia(k)*F_sp0(i))
*            If ever ETA levels have non-uniform F_spt:
*            srclev(i,k)= log(F_spt(i)+F_seta(k)*(F_sp0(i)-F_spt(i)))
          enddo
          enddo
      else
          do k=1,nks
          do i=1,n
             srclev(i,k)= log((F_spia(k) + F_spib(k) * F_sp0(i)))
          enddo
          enddo
      endif
*  
      do k=1,nkd
      do i=1,n
         dstlev(i,k)= log(F_dpres(i,k))
      enddo
      enddo

      call vte_intvertx(F_dch,F_sch,srclev,dstlev,n,nks,nkd,F_var)

      return
      end

