***s/r bcastc1
*
#include "model_macros_f.h"
*
      subroutine bcastc1
*
*implicits
      use v4dz, only: V4dz_degree,V4dzge_degree,V4dzga_degree
*
      implicit none
*
*author
*     Michel Desgagne
*
*revision
* v2_00 - Desgagne M.       - initial MPI version
* v2_10 - Tanguay M.        - add comdecks 4D-Var 
* v2_10 - Qaddouri A.       - higher order diffusion operator
* v2_11 - Desgagne M.       - broadcast common Hzdl
* v2_11 - Desgagne M.       - broadcast common vspng for vertical sponge
* v2_20 - Lee V.            - broadcast changes due to physics 3.66  
* v2_21 - Desgagne M.       - rpn_comm stooge for MPI
* v2_21 - Lee V.            - broadcast path for slab outputs
* v2_30 - Edouard S.        - adapt for vertical hybrid coordinate
* v2_30 - Lee V.            - broadcast common Out_c
* v2_31 - Lee V.            - allocate Geomg_hyb,change Geomg_eta to Geomg_hybm
* v2_32 - Lee V.            - removed broadcast for P_pbl,P_gwd variables
* v3_00 - Desgagne & Lee    - Lam configuration
* v3_01 - Toviessi J. P.    - add eigenmodes with definite parity
* v3_01 - Lee V.            - broadcast common hspng for horizontal sponge
* v3_02 - Tanguay M.        - Broadcast V4dz_degree,V4dzge_degree,V4dzga_degree
* v3_03 - Desgagne M.       - replace stop by stopmpi
* v3_11 - Gravel S.         - broadcast common theo and vtopo
* v3_20 - Gravel S.         - broadcast common vrtd and zblen
* v3_20 - Tanguay M.        - Option of storing instead of redoing TRAJ
* v3_20 - Buehner & Zadra   - Add broadcast of V4d_gen_c
* v3_21 - Valcke, S.        - Remove broadcast of C_pipe, C_nml, C_step
* v3_21 - Lee V.            - Remove broadcast of TR2d..., added Lctl_i
* v3_22 - Gravel S.         - Add broadcast of mtn_r
*
*object
*
*arguments
*        none
*
*implicits
#include "glb_ld.cdk"
#include "glb_pil.cdk"
#include "dimout.cdk"
#include "level.cdk"
#include "mem.cdk"
#include "path.cdk"
#include "step.cdk"
#include "grd.cdk"
#include "geomg.cdk"
#include "p_geol.cdk"
#include "out1.cdk"
#include "hgc.cdk"
#include "xst.cdk"
#include "init.cdk"
#include "offc.cdk"
#include "schm.cdk"
#include "adw.cdk"
#include "lctl.cdk"
#include "cstv.cdk"
#include "out3.cdk"
#include "pres.cdk"
#include "ptopo.cdk"
#include "pilot.cdk"
#include "hblen.cdk"
#include "hzd.cdk"
#include "eigv.cdk"
#include "vspng.cdk"
#include "hspng.cdk"
#include "cori.cdk"
#include "tr3d.cdk"
#include "v4dg.cdk"
#include "v4dj.cdk"
#include "v4dm.cdk"
#include "theo.cdk"
#include "bubble.cdk"
#include "mtn.cdk"
#include "vtopo.cdk"
#include "vrtd.cdk"
#include "zblen.cdk"
#include "v4dr.cdk"
#include "offline.cdk"
#include "ens_param.cdk"
*
      integer err
*------------------------------------------------------------------
*
      COMMON_BROADCAST(G)
      COMMON_BROADCAST(G_l)
      COMMON_BROADCAST(Pgeol_l)
      COMMON_BROADCAST(Meml)
      COMMON_BROADCAST(Memi)
      COMMON_BROADCAST(Stepi)
      COMMON_BROADCAST(pres)
      COMMON_BROADCAST(pres_l)
      COMMON_BROADCAST(Xst_i)
      COMMON_BROADCAST(Xst_r)
      COMMON_BROADCAST(Pils)
      COMMON_BROADCAST(Pill)
      COMMON_BROADCAST(Pili)
      COMMON_BROADCAST(Hblen_i)
      COMMON_BROADCAST(Hblen_s)
      COMMON_BROADCAST(Hgc)
      COMMON_BROADCAST(Hgc_s)
      COMMON_BROADCAST(Out1)
      COMMON_BROADCAST(Out1c)
      COMMON_BROADCAST(Ens_c)
      COMMON_BROADCAST(Ens_l)
      COMMON_BROADCAST(Ens_i)
      COMMON_BROADCAST(Ens_r)
      COMMON_BROADCAST(Grd_c)
      COMMON_BROADCAST(Grd_l)
      COMMON_BROADCAST(Grd_i)
      COMMON_BROADCAST(Grd_r)
      COMMON_BROADCAST(Grd_r8)
      COMMON_BROADCAST(Initl)
      COMMON_BROADCAST(Initn)
      COMMON_BROADCAST(Initr)
      COMMON_BROADCAST(Offc)
      COMMON_BROADCAST(Schm_l)
      COMMON_BROADCAST(Schm_i)
      COMMON_BROADCAST(Schm_r8)
      COMMON_BROADCAST(Adw_l)
      COMMON_BROADCAST(Adw_ia)
      COMMON_BROADCAST(Lctl_l)
      COMMON_BROADCAST(Lctl_i)
      COMMON_BROADCAST(Cori_l)
      COMMON_BROADCAST(Cstv)
      COMMON_BROADCAST(Path1)
      COMMON_BROADCAST(Path2)
      COMMON_BROADCAST(Hzdl)
      COMMON_BROADCAST(Hzdi)
      COMMON_BROADCAST(Hzdr)
      COMMON_BROADCAST(Hzdc)
      COMMON_BROADCAST(Eigvl)
      COMMON_BROADCAST(Tr3d_c)
      COMMON_BROADCAST(Tr3d_i)
      COMMON_BROADCAST(Tr3d_r)
      COMMON_BROADCAST(vspngl)
      COMMON_BROADCAST(vspngi)
      COMMON_BROADCAST(vspngr)
      COMMON_BROADCAST(hspngl)
      COMMON_BROADCAST(hspngi)
      COMMON_BROADCAST(hspngr)
      COMMON_BROADCAST(Out3_l)
      COMMON_BROADCAST(Out3_c)
      COMMON_BROADCAST(Out3_i)
      COMMON_BROADCAST(Level_l)
      COMMON_BROADCAST(V4d_gen_i)
      COMMON_BROADCAST(V4d_gen_l)
      COMMON_BROADCAST(V4d_gen_r)
      COMMON_BROADCAST(V4d_gen_c)
      COMMON_BROADCAST(V4d_jcst_i)
      COMMON_BROADCAST(V4d_jcst_r)
      COMMON_BROADCAST(V4d_jcst_l)
      COMMON_BROADCAST(V4d_min_i)
      COMMON_BROADCAST(V4d_min_r)
      COMMON_BROADCAST(theo_s)
      COMMON_BROADCAST(bubble_r)
      COMMON_BROADCAST(mtn_r)
      COMMON_BROADCAST(vtopo_l)
      COMMON_BROADCAST(vtopo_i)
      COMMON_BROADCAST(vrtd_l)
      COMMON_BROADCAST(vrtd_r)
      COMMON_BROADCAST(zblen_l)
      COMMON_BROADCAST(zblen_r)
      COMMON_BROADCAST(offline_c)
      COMMON_BROADCAST(offline_i)
      COMMON_BROADCAST(Glb_pil_i)
      COMMON_BROADCAST(V4d_redo_i)
      COMMON_BROADCAST(V4d_redo_l)
*
      call RPN_COMM_bcast(Ptopo_nblocx, 1,"MPI_INTEGER",0,"grid",err )
      call RPN_COMM_bcast(Ptopo_nblocy, 1,"MPI_INTEGER",0,"grid",err )
      call RPN_COMM_bcast(V4dz_degree,  1,"MPI_INTEGER",0,"grid",err )
      call RPN_COMM_bcast(V4dzge_degree,1,"MPI_INTEGER",0,"grid",err )
      call RPN_COMM_bcast(V4dzga_degree,1,"MPI_INTEGER",0,"grid",err )
************************
*** COMMONBROADCAST(pres_l) above is not valid due to typo error in pres.cdk
*** Broadcast will be done as follows:
      call RPN_COMM_bcast(Pres_vtap_L,1,"MPI_LOGICAL",0,"grid",err )
************************
*
      err = 0
      if (.not.Path_swv1_L) then
         print*, 'Problem in set_world_view1 -- ABORT --'
         err = -1
      endif
      call stopmpi(err)
*
      if (Ptopo_myproc.gt.0) then
          call hpalloc (Geomg_hyb_ , G_nk, err, 1)
          call hpalloc (Geomg_hybm_, G_nk, err, 1)
          call hpalloc (Geomg_pia_ , G_nk, err, 1)
          call hpalloc (Geomg_pibb_, G_nk, err, 1)
          call hpalloc (Geomg_dpba_, G_nk, err, 1)
      endif
*
      call RPN_COMM_bcast (Geomg_hyb ,G_nk,"MPI_REAL",0,"grid",err)
      call RPN_COMM_bcast (Geomg_hybm,G_nk,"MPI_REAL",0,"grid",err)
      call RPN_COMM_bcast (Geomg_pia ,G_nk,"MPI_REAL",0,"grid",err)
      call RPN_COMM_bcast (Geomg_pibb,G_nk,"MPI_REAL",0,"grid",err)
      call RPN_COMM_bcast (Geomg_dpba,G_nk,"MPI_REAL",0,"grid",err)
*
*------------------------------------------------------------------
      return
      end
