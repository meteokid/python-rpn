***s/r e_pregeo- prepare the geophysical fields
*
#include "model_macros_f.h"
*
      subroutine e_pregeo 
      implicit none
*
*author 
*     Andre Methot
*
*revision
* v3_20  - Roch/Bilodeau     - change units of snodp
*
*object
*
*arguments
*	none
*
*implicits
      integer l_ni,l_nj
      parameter(l_ni=1,l_nj=1)
#include "e_grids.cdk"
#include "e_geol.cdk"
#include "p_bus.cdk"
#include "p_pbl.cdk"
#include "p_geobus.cdk"
#include "dcst.cdk"
#include "hgc.cdk"
**
      integer gdll
      external gdll
      integer i,j,offj,n,err
      real deg2rad
*
*     ---------------------------------------------------------------
*
      write(6,9000)
      n=nifi*njfi
*
      err = gdll (dstf_gid,geobus(la),geobus(lo))
*
      deg2rad  = acos(-1.0)/180.
*
      do i=1,n
         geobus(la    +    i-1) = geobus(la+i-1) * deg2rad
         geobus(lo    +    i-1) = geobus(lo+i-1) * deg2rad
         geobus(glsea +    i-1) = max(min(geobus(glsea+i-1),1.0),0.0)
         geobus(mg    +    i-1) = max(min(geobus(mg   +i-1),1.0),0.0)
         geobus(ga    +    i-1) = max(min(geobus(ga   +i-1),1.0),0.0)
      end do
      if (geobus(twater).lt.150.) then
         do i=1,n
            geobus(twater +i -1) = geobus(twater +i -1) + dcst_tcdk_8
         end do
      endif
      if (geobus(i0).lt.150.) then
         do i=1,n
            geobus(i0 +i -1) = geobus(i0 +i -1) + dcst_tcdk_8
         end do
      endif
      if (geobus(i0+n).lt.150.) then
         do i=1,n
            geobus(i0 + n +i -1) = geobus(i0 + n +i -1) + dcst_tcdk_8
         end do
      endif
      if (geobus(gmice).lt.150.) then
         do i=1,n
            geobus(gmice +i -1) = geobus( gmice+i -1) + dcst_tcdk_8
         end do
      endif
      if (geobus(gmice+n).lt.150.) then
         do i=1,n
            geobus(gmice + n +i -1) = geobus( gmice+ n+i -1) + dcst_tcdk_8
         end do
      endif
      if (geobus(gmice+ 2*n).lt.150.) then
         do i=1,n
            geobus(gmice + 2*n +i -1) = geobus( gmice+ 2*n +i -1) + dcst_tcdk_8
         end do
      endif
      if (geobus(gice).lt.150.) then
         do i=1,n
            geobus(gice+i -1) = geobus(gice+i -1) + dcst_tcdk_8
         end do
      endif
      if (geobus(gice+n).lt.150.) then
         do i=1,n
            geobus(gice + n +i -1) = geobus(gice+ n +i -1) +dcst_tcdk_8
         end do
      endif
      if (glseac.gt.0) then
         do i=1,n
            geobus(glseac+i-1)=max(min(geobus(glseac+i-1),1.0),0.0)
         end do
      endif
      if (snodp.gt.0) then
         do i=1,n
            geobus(snodp+i-1) = 0.01 * geobus(snodp+i-1)
         end do
      endif
*
      if ( E_geol_glreg_L ) call e_modgl ()
*
      if (  P_pbl_schsl_s.eq. 'FCREST' ) then       
         call e_modhs ()
         call e_modmg ()
      endif
*
      if ( E_geol_z0cst.lt.0.) then
         do i=1,n
            geobus(z0+i-1) = exp ( geobus(z0+i-1) )
         end do
      else
         print*, 'zo constant: ',E_geol_z0cst
         do i=1,n
            geobus(z0+i-1) = E_geol_z0cst
         end do
      endif
*
      write(6, 9999)
*     
 9000 format(/,'BEGIN PROCESSING GEOPHYSICAL FIELDS (S/R E_PREGEO)',
     +       /,'=================================================')
*
 9999 format(/,'END PROCESSING GEOPHYSICAL FIELDS (S/R E_PREGEO)',
     +       /,'==================================================')
*
*     ---------------------------------------------------------------
*
      return
      end
