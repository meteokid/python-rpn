***s/r tr_init - Initializes tracers
*
#include "model_macros_f.h"
*
      subroutine tr_init ( hu,data_spec,bmf_time1,bmf_time2,nk,pps, 
     $                         rna_pia,pibb,ps,vterp_lv,ni,nj,nesd )
      implicit none
*
      logical nesd
      integer data_spec(*),nk,bmf_time1,bmf_time2,vterp_lv,ni,nj
      real hu(ni,nj,*),pps(*),rna_pia(*),ps(*),pibb(*)
*
*author
*     Michel Desgagne  -  Sept 2001
*
*revision
* v2_31 - Desgagne M.       - initial version 
* v3_00 - Desgagne & Lee    - Lam configuration
* v3_21 - Lee V.            - remove Tr2d
*
*object
*
*arguments
*   
*implicits
#include "glb_ld.cdk"
#include "tr3d.cdk"
#include "nest.cdk"
#include "vt1.cdk"
#include "func.cdk"
*
      integer  write_db_file,rewind_db_file,vmmlod,vmmget,vmmuld
      external write_db_file,rewind_db_file,vmmlod,vmmget,vmmuld
*
      integer i,j,k,n,err,key0,key(Tr3d_ntr),keyh
      real w1(l_ni,l_nj,nk),w2(l_ni,l_nj,nk),buf(l_ni,G_nk+1),tr
      pointer (patr, tr(LDIST_SHAPE,*))
*
*     ---------------------------------------------------------------
*
      if (nesd) then
         key0 = VMM_KEY (nest_trf)
      else
         key0 = VMM_KEY (trt1)
      endif
      do k=1,Tr3d_ntr
         key(k) = key0 + k
      end do
      if (Tr3d_ntr.gt.0) then
         keyh=VMM_KEY(hdia)
         err = vmmlod(key,Tr3d_ntr)  
         err = vmmlod(keyh,1)  
         err=VMM_GET_VAR(hdia)
         do k=1,Tr3d_ntr
            err = vmmget(key(k),patr,tr)
            if (Tr3d_name_S(k).eq.'HU') then
               do n=1,G_nk+1
               do j=1,l_nj
               do i=1,l_ni
                  tr(i,j,n) = max(0., hu(i,j,n))
               end do
               end do
               end do
               do j=1,l_nj
               do i=1,l_ni
                  hdia(i,j) = tr(i,j,G_nk+1)
               end do
               end do
            else
               call tr_vint (tr,Tr3d_name_S(k),Tr3d_sval(k),data_spec,
     $                       bmf_time1,bmf_time2,nk,pps,
     $                       rna_pia,pibb,ps,vterp_lv,LDIST_DIM)
            endif
         end do
         err = vmmuld(key,Tr3d_ntr)
         err = vmmuld(keyh,1)
      endif
*
*     ---------------------------------------------------------------
*
      return
      end


