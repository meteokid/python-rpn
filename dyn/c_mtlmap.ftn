C**S/R c_mtlmap
C=======================================================================
C Author:
C 
C   Sophie Valcke -RPN/CERFACS - March 2005
C
*revision
* v3_21 - Valcke S.   - initial MPI version
*
C Language:
C
C   Fortran 77
C
C Description:
C
C   Write coupling fields to RPN "standard" files
C   
C Interface:
C
      SUBROUTINE c_mtlmap (RS,nx,ny,nk1,cd_inname,id_oatime,cd_file,id_unit)
      IMPLICIT NONE
C
C Input Arguments
C
      INTEGER nx,ny,nk1
      REAL RS(nx,ny,nk1)
      INTEGER id_oatime, id_unit
      CHARACTER*3 cd_inname
      CHARACTER*80 cd_file
C
C Local variables
C
      INTEGER  il_err, fnom, fclos, i, j
      REAL wk3(nx,ny),wk2
c
      il_err = FNOM (id_unit, cd_file, 'RND', 0)
      CALL fstouv (id_unit,'RND')
c
      do j = 1, ny
        do i = 1,nx
           wk3(i,j)=rs(i,j,1)
           if (wk3(i,j).gt.1000.0) wk3(i,j)=-999999.
           if (wk3(i,j).lt.-1000.0) wk3(i,j)=-999999.
        enddo
      enddo
      CALL fstecr (wk3,WK2,-32,id_unit,0,180,id_oatime,nx,ny,
     $1,0,id_oatime,0,'P',cd_inname,'RSLT2','X',1,1,1,1,1,.false.)
      CALL fstfrm (id_unit)
      il_err = fclos(id_unit)
c
      RETURN
      END
