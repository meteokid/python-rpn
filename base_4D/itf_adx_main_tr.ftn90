!---------------------------------- LICENCE BEGIN -------------------------------
! GEM - Library of kernel routines for the GEM numerical atmospheric model
! Copyright (C) 1990-2010 - Division de Recherche en Prevision Numerique
!                       Environnement Canada
! This library is free software; you can redistribute it and/or modify it
! under the terms of the GNU Lesser General Public License as published by
! the Free Software Foundation, version 2.1 of the License. This library is
! distributed in the hope that it will be useful, but WITHOUT ANY WARRANTY;
! without even the implied warranty of MERCHANTABILITY or FITNESS FOR A
! PARTICULAR PURPOSE. See the GNU Lesser General Public License for more details.
! You should have received a copy of the GNU Lesser General Public License
! along with this library; if not, write to the Free Software Foundation, Inc.,
! 59 Temple Place - Suite 330, Boston, MA 02111-1307, USA.
!---------------------------------- LICENCE END ---------------------------------

!**s/r itf_adx_main_tr - Equivalent to itf_adx_main for TRAJECTORY 
!
#include "model_macros_f.h"
!
      subroutine itf_adx_main_tr (F_it)
!
      implicit none
#include <arch_specific.hf>
!
      integer F_it
!
!author M.Tanguay
!
!revision
! v2_31 - Tanguay M.        - initial MPI version
! v3_00 - Tanguay M.        - adapt to restructured adw_main 
! v3_20 - Tanguay M.        - Option of storing instead of redoing TRAJ 
! v3_21 - Tanguay M.        - Revision Openmp
! v4_04 - Tanguay M.        - Staggered version TL/AD 
! v4_10 - Tanguay M.        - VMM replacement with GMM for (TL/AD)
! v4_12 - Tanguay M.        - TL/AD Thermo upstream positions
! v4_40 - Tanguay M.        - Revision TL/AD
!
!object
!     see id section
!
!arguments
!______________________________________________________________________
!        |                                                       |     |
! NAME   | DESCRIPTION                                           | I/O |
!--------|-------------------------------------------------------|-----|
! F_it   | total number of iterations for trajectories           |  i  |
!________|_______________________________________________________|_____|
!
!implicits
#include "gmm.hf"
#include "rhsc_m.cdk"
#include "orh_m.cdk"
!
      type(gmm_metadata) :: mymeta
      integer :: istat

!***********************************************************************
!
!     Recover TRAJ RHS interpolated
!     -----------------------------
      call v4d_rwtraj (6)
!
!     Store TRAJ RUW2/RVW2 in ORH for PRE_AD
!     --------------------------------------
      istat = gmm_get(gmmk_ruw2_m_s,ruw2_m,mymeta)
      if (GMM_IS_ERROR(istat)) print *,'adw_main_tr ERROR at gmm_get(ruw2_m)'
      istat = gmm_get(gmmk_rvw2_m_s,rvw2_m,mymeta)
      if (GMM_IS_ERROR(istat)) print *,'adw_main_tr ERROR at gmm_get(rvw2_m)'
      istat = gmm_get(gmmk_oruw2_m_s,oruw2_m,mymeta)
      if (GMM_IS_ERROR(istat)) print *,'adw_main_tr ERROR at gmm_get(oruw2_m)'
      istat = gmm_get(gmmk_orvw2_m_s,orvw2_m,mymeta)
      if (GMM_IS_ERROR(istat)) print *,'adw_main_tr ERROR at gmm_get(orvw2_m)'
!
      oruw2_m = ruw2_m
      orvw2_m = rvw2_m
!
!**********************************************************************
!
      return
      end
